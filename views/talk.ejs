
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I KNOW YOU</title>
    <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="style.css"/>
    <script src="style.js"></script>
    <meta http-equiv="refresh"/>
    <!---------------swiper js-->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-element-bundle.min.js"></script>
</head>

<script>
    function preventBack() { window.history.forward(); }
    setTimeout("preventBack()", 0);
    window.onunload = function (e) {e.preventDefault()};
</script>

<body>
    <% if(typeof result !== 'undefined'){%>
       <div class="load">
            <%-include('load.ejs') %>
       </div>
<script>
    $(document).ready(function(){
        setInterval(()=>{
            $('.load').hide('animate');
            $('#body').fadeIn();
        }, 4000)
    })
</script>
<%}%>

<div id="body">
    <nav class="navbar" id="myNavbar">
        <div class="navbar-brand">
            <a href="#" class="navbar-item" id="users-btn"><i class="bi bi-people-fill" id="users"></i></a>
            <div class="users-menu">
                <h1>MESSAGE</h1>
                <hr/>
                <% if(typeof rst !== 'undefined'){ %>
                    <% rst.forEach((items) => { %>
                        <div class="post-body">
                            <img class="post-avatar" src="<%=items.pic%>" alt="avatar"/>
                            <div class="post-detail">
                                <h2 class="post-name"><%=items.username%>, <%=items.age%></h2>
                                <p class="post-author"><%=items.prelationship %></p>
                            </div>
                            <div class="post-actions">
                                <form method="post">
                                    <% if(typeof result !== 'undefined'){ %>
                                        <% result.forEach(detailers => { %>
                                            <input type="text" name="userid" value="<%=detailers.id%>" hidden/>
                                        <% }) %>
                                        <% } %>
                                    <input type="text" name="chat" value="<%=items.id%>" hidden/>
                                <button type="submit" class="post-btn">
                                    <i class="bi bi-chat-dots-fill"></i>
                                </button>
                                </form>
                            </div>
                        </div>
                    <% }) %>
                    <% } %>
            </div>
        </div>

        <h1>I KNOW YOU</h1>

        <div class="navbar-nav">
            <% if(typeof result !== 'undefined'){ %>
                <% result.forEach(detailer => { %>
        <a href="#" class="navbar-item" id="gears-btn"><i class="bi bi-gear-wide-connected" id="gears"></i></a>
              <% }) %>
              <% }else{ %>
              <h3>Could not load data</h3>
              <% } %>
         <div class="gear-menu">
            <% if(typeof result !== 'undefined'){ %>
                <% result.forEach(detail => { %>
            <img src="<%=detail.pic%>" class="profile-pic"/>
           
            <h3 class="user-statuses">
               <%= detail.username %>
            </h3>

            <h3><%=detail.fname%> <%=detail.lname%></h3>
            <div class="btns">
                <a href="" class="user-button"><i class="bi-emoji-smile"></i> <span>Status</span></a>
                <a href="" class="user-button"><i class="bi-pencil-fill"></i> <span>Edit</span></a>
            </div>
            <div class="user-logout">
                <form action="/logout">
                    <input type="text" class="userid" name="userid" value="<%=detail.id%>" hidden/>
                <button class="logout-button"><i class="bi-box-arrow-in-right"></i> <span>Logout</span></button>
                </form>
            </div>
            <% }) %>
            <% } %>
         </div>   
        </div>
        </nav>
        
        
        <section>
           <div class="container">
                <h1>Chats</h1>
                <% if(typeof chatuser !== 'undefined'){ %>
                    <% chatuser.forEach(datauser => { %>
                        <img src="<%=datauser.pic%>" class="post-avatar"/>
                    <% }) %>
                    <% } %>
                <div class="chatzone">
                 <!---chatzone--------->
                 <% if(typeof talk !== 'undefined'){ %>
                    <% talk.forEach(chats => { %>
                        <% if(typeof chatuser !== 'undefined'){ %>
                            <% chatuser.forEach(datauser => { %>
                              
                                <% if(chats.fromid === datauser.id){  %>
                                    <div class="alert-mess">
                                        <p><%=chats.mesg%></p>
                                    </div>
                                   <% } %>

                                   <% if(chats.fromid !== datauser.id){  %>
                                    <div class="alert-user">
                                        <p><%=chats.mesg%></p>
                                    </div>
                                   <% } %>

                                  <% }) %>
                                 <% } %>
                                 <% }) %>
                <% }else{ %>
               <div class="alert-mess">
                <p>Start a new message</p>
               </div>
                <%}%>
                </div>
                <div class="senders">
                   
                    <div class="options">
                        <div class="options-icon">
                        <i class="bi bi-image-fill"></i>
                        <i class="bi bi-files"></i>
                        <i class="bi bi-earbuds"></i>
                        </div>
                    </div>

                    <% if(typeof chatuser !== 'undefined'){ %>
                        <% chatuser.forEach(datauser => { %>
                            <input type="text" name="tid" id="tid" value="<%=datauser.id%>" hidden/>
                        <% }) %>
                        <% } %>

                        <% if(typeof result !== 'undefined'){ %>
                            <% result.forEach(userd => { %>
                                <input type="text" name="frmid" id="frmid" value="<%=userd.id%>" hidden/>
                            <% }) %>
                            <% } %>

                <input class="textarea" name="mess" id="mess"/>
                <button type="button" class="attach"><i class="bi bi-paperclip"></i></button>
                <button type="submit" class="send" onclick="sendMessage()"><i class="bi bi-send-arrow-up-fill"></i></button>


               </div>
            </div>
        </section>
</div>

</body>
</html>